generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  firstName String
  lastName String
  username  String   @unique
  password  String
  createdAt DateTime @default(now())
} 

model Learner {
  id         Int       @id @default(autoincrement())
  firstName  String
  lastName   String
  marks Mark[]
}

model Pathway {
  id         Int       @id @default(autoincrement())
  name       String    @unique
  description String?
  subjects   Subject[]
  pathways   PathwaySubject[]
}

model PathwaySubject {
  id        Int     @id @default(autoincrement())
  pathwayId Int
  subjectId Int
  weight    Float   @default(1.0) 

  pathway   Pathway @relation(fields: [pathwayId], references: [id])
  subject   Subject @relation(fields: [subjectId], references: [id])

  @@unique([pathwayId, subjectId]) 
}


model Subject {
  id         Int       @id @default(autoincrement())
  name       String
  weight     Float     @default(1.0)
  pathwayId  Int
  pathway    Pathway   @relation(fields: [pathwayId], references: [id])
  marks       Mark[]
  pathways   PathwaySubject[] 
}


model Mark {
  id         Int      @id @default(autoincrement())
  score      Float   
  createdAt  DateTime @default(now())
  learnerId  Int
  subjectId  Int
  learner    Learner  @relation(fields: [learnerId], references: [id])
  subject    Subject  @relation(fields: [subjectId], references: [id])

  @@index([learnerId])
  @@index([subjectId])
  @@unique([learnerId, subjectId], map: "one_mark_per_learner_subject_exam")
}